<!-- Menu -->
<div class="sticky-container">
		<ul class="sticky">
			<li>
                            <span><i class="fa fa-clock-o"></i></span>
				<p>Time Report</p>
			</li>
                </ul>
</div>
<div class="custom_menu ">
    <div class="widgethedsub">Time Report</div>
    <div class="row">
        <div class="col-xs-12 col-sm-6 col-md-6 ">
            
           <div class="row">
        <div class="col-xs-12 col-sm-4 col-md-4 errorshow ">
            <label class="timereportlabel">From</label>
            <p-calendar [(ngModel)]="fromDateVal" class="primeDateComponent customcalenderdiv" (onSelect)="FromDate($event)" [readonlyInput]="true" [maxDate]="calendarVal" [showIcon]="true" [hidden]="showMyEditableField" dateFormat="M-dd-yy" >
      </p-calendar>
        <!--<div id="fromDate_error" [hidden]="true" class="alert alert-danger">From Date is Required</div>-->
            
        </div>
        <div class="col-xs-12 col-sm-4 col-md-4 ">
            <label class="timereportlabel">To</label>
             <p-calendar [(ngModel)]="toDateVal" class="primeDateComponent customcalenderdiv" (onSelect)="ToDate($event)" [readonlyInput]="true" [maxDate]="calendarVal" [showIcon]="true" [hidden]="showMyEditableField" dateFormat="M-dd-yy" >
      </p-calendar>
            
        <div id="toDate_error" [hidden]="true" class="fielderror">To Date is must be greater than From Date</div>
            
        </div>
               
       <div class="col-xs-12 col-sm-4 col-md-4 paddingtop20">
           
            <button (click)="DateRangeForm()" class="normal bluebutton bluebuttonmedium buttonmediumheight">GO</button>
            
        </div>

    </div>
            
        </div>
        <div class="col-xs-12 col-sm-6 col-md-6 ">
            <div class=" pull-right">
                <div class="timereportdiv">
                    <ul>
                        <li>
                            <div class="timeboxtitle">Last {{showdays}}</div>
                            <div  class="timeboxlabel">Total worked hours</div>
                            
                        </li>
                        <li>
                            <div class="timecountouter"><i class="fa fa-clock-o" aria-hidden="true"></i>
                            <div class="timewrapbox">{{last7daystimehours}}</div>
                            </div>
                        </li>
                        
                    </ul>
                        
                    </div>
                        
                    </div>
            
            
        </div>
    </div>
    <hr class="topdivider"/>
  <div class="row paddingtop5">
      <div class="col-xs-12 col-sm-6 col-md-6 ">
          <div class="widgethedsub">Time Tracking</div>
      </div>
    <div class="col-xs-12 col-sm-6 col-md-6 ">
        <div class="pull-right">
           
        <div class="add" data-backdrop="false" data-toggle="modal" data-target="#addTimelogModel" ><i  class="fa fa-plus"></i>
        </div>
     
</div>
    </div>
   </div>

</div>

<ngx-datatable
        #myTable 
        class="material expandable customdatatable"
        [rows]="rows"
        [columnMode]="'flex'"
        [headerHeight]="40"
        [footerHeight]="40"
        [rowHeight]="'auto'"
        [externalPaging]="true"
        [externalSorting]="true"
        [count]="count"
        [offset]="offset"
        [limit]="limit"
        [sortable]= "true"
        (page)="onPage($event)"
        (sort)="onSort($event)"
        >
<!-- Column Template -->
<!--The table column(s) width take dynamically.
Row classes are also dynamically. These classes are pass to service layer-->
 <ngx-datatable-column *ngFor="let column of columns;let i=index;" name="{{column.name}}" prop="{{column.sortby}}" [resizeable]="false"
  [flexGrow]="column.flexGrow">
  
  <template let-row="row" ngx-datatable-cell-template >
    <div attr.class="{{i}}">
   <div style="cursor:default" class="{{column.class}} " *ngIf="row[i].field_name!='action' && row[i].field_name!='Id'" >
      {{row[i].field_value}}
       
   
   </div>
        <div class="{{column.class}} " *ngIf="row[i].field_name!='action' && row[i].field_name=='Id'" >
        <img *ngIf="row[i].other_data==1" src="assets/images/story-icon.png"  />
      <img *ngIf="row[i].other_data==2" src="assets/images/task-icon.png" />
      <a *ngIf="row[i].field_name=='Id'" (click)="navigateToStoryDetail(row[i].ticketId)">{{row[i].field_value}} </a>
       
   
   </div>
      <div style="cursor:default" *ngIf="row[i].field_name =='action'" class="{{column.class}}" style="position: relative">
        
          <input type="button" class="normal bluebutton bluebuttonmedium tablebuttons" name="EDIT" value="EDIT" data-backdrop="false"  data-toggle="modal"   [attr.data-target]="'#myModal_'+ row[i].Slug.$oid" />
          <input type="button" class="normal bluebutton bluebuttonmedium tablebuttonsgrey tablebuttons" name="DELETE" value="DELETE" (click)="showdeleteDiv(1)"/>
      <div  class="dropdown-menu customdropdown-menutable customdropdown-menutablealignment" id="delete_timelog">
            <div class="delete_followersbgtable" >  
                Do you want to remove this Timelog?
                <div class="text-center" style=" padding-top:10px">
                    <div class="yes" id="remove_yes" (click)="removeTimelog(row[i].ticketDesc,row[i].Slug.$oid,row[i].Time)">YES</div>
                    <div class="no" (click)="showdeleteDiv(2)">NO</div>
        </div>
            </div>
        </div>
      </div> 


        

     </div> 
              <div class="modal fade custommodel "  id="myModal_{{row[i].Slug.$oid}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog"  id="{{row[i].Slug.$oid}}" >
    <div class="modal-content" style="z-index:9999;">
      <div class="modal-header">
        <h5 class="modal-title">Edit Entry</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="timelogSuccessMsg"> Timelog updated successfully</div>
        <form   #editTimeLogForm="ngForm" (ngSubmit)="submitted && editTimeLogForm.form.valid && updateTimelog(row[i].Slug.$oid,row[i].ticketDesc,row[i].readableDate)" novalidate="true">

      <div class="modal-body">

          <div class="row">
              <div class="col-xs-12 col-sm-12 col-md-12 ">
                  <label class="timereportlabel"> Story/Task </label>
                  <div class="customformfieldsmarginbottom">
                 <p-autoComplete  [ngModel]="row[i].ticketDesc" name="ticketDesc_{{row[i].Slug.$oid}}"  (onSelect)="getSelectedValueForTask($event)" [minLength]="1" placeholder="list of tasks" [suggestions]="search_results"  [style]="{'width':'100%'}"  (completeMethod)="searchTask($event)" id="taskdisplay_{{row[i].Slug.$oid}}"  (blur)="inputKeyDownFovalid(row[i].Slug.$oid)"></p-autoComplete>
                  </div>
              </div>
                     <div class="col-xs-12 col-sm-12 col-md-12 relativediv">
                        <div class="taskErrormes"></div>
           </div>
           <!--<div class="col-xs-12 col-sm-12 col-md-12  relativediv">
              <div *ngIf="submitted && ticketDesc_+'row[i].Slug.$oid'+'.'+errors" class="fielderror" >
               Story/task is required
                <div [hidden]="!ticketDesc_+row[i].Slug.$oid+'.'+errors+'.'+required">
                    Task is required 
                </div>
               
            </div>
          </div>-->
          </div> 
             <div class="row">
              <div class="col-xs-12 col-sm-12 col-md-12 ">
                  <label class="timereportlabel"> Description </label>
                 <!-- <p *ngIf="row[i].ticketDesc.includes('#')"> 
                      <input type="text" class="customformfields "   value="{{row[i].ticketDesc.split(row[i].ticketId)[1]}}"  id="editableDesc_{{row[i].Slug.$oid}}"/>-->
                  <p>
                  <textarea class="customformfieldstextarea customformfieldsmarginbottom" value="{{row[i].description}}" [(ngModel)]="row[i].description"  id="editableDesc_{{row[i].Slug.$oid}}"  name="editableDesc_{{row[i].Slug.$oid}}" ></textarea></p>

              </div>
                 <div class="col-xs-12 col-sm-12 col-md-12 relativediv">
                        <div class="descErrormes"></div>
           </div>
             
               <!-- <div class="col-xs-12 col-sm-12 col-md-12  alert alert-danger" id="descriptionerr_msg">
                    Description is required
                </div>-->
                <!-- <div class="col-xs-12 col-sm-12 col-md-12 relativediv">
              <div *ngIf="submitted && editableDesc_+'row[i].Slug.$oid'+'.'+errors" class="fielderror" >
                Description is required
               
            </div>
          </div>-->
          </div>
          <div class="row">
              <div class="col-xs-12 col-sm-4 col-md-4 ">
                  <label class="timereportlabel"> Hours </label>
                  <input type="text"  class="customformfields " value="{{row[i].Time}}"  id="editTimelogTime_{{row[i].Slug.$oid}}" (keyup)="inputKeyDown(2,row[i].Slug.$oid)" [(ngModel)]="row[i].Time" name="time_{{row[i].Slug.$oid}}" />
              </div>
            
                <div class="hoursErrormes"></div>
             
                <!-- <div class="col-xs-12 col-sm-12 col-md-12 relativediv">
              <div *ngIf="submitted && time_+'row[i].Slug.$oid'+'.'+errors" class="fielderror" >
                Hours is required
                
            </div>
          </div>-->
              <div class="col-xs-12 col-sm-8 col-md-8 ">
                  <label class="timereportlabel"> Date </label>
                  <div class="paddingright25 ">
                      <p-calendar  [(ngModel)]="row[i].LogDate" name="LogDate_{{row[i].Slug.$oid}}" #LogDate="ngModel" class="primeDateComponent customcalenderdiv addTimelogDate" (onSelect)="getSelectedValueForDate($event)"  [readonlyInput]="true" [minDate]="minDate" [showIcon]="true"  dateFormat="M-dd-yy" >

              </p-calendar>
                  </div>
              </div>
                  <div class="col-xs-12 col-sm-8 col-md-8relativediv">
                        <div class="dateErrormes"></div>
           </div>
          </div>
          
            
            </div>
      <div class="modal-footer">
        <button type="submit" class="normal bluebutton bluebuttonmedium" (click)="submitted=true;" >UPDATE</button>
        <button type="button" class="normal bluebutton bluebuttonmedium tablebuttonsgrey" data-dismiss="modal">CANCEL</button>
      </div>
       </form>
    </div>
  </div>
</div> 
</template>
</ngx-datatable-column>

<!-- Column Template -->

</ngx-datatable>
        <div class="modal fade custommodel"  id="addTimelogModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Add Entry</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="timelogSuccessMsg"> Timelog added successfully</div>
    <!-- <form   #timeLogForm="ngForm" (ngSubmit)="submitted && timeLogForm.form.valid && addTimeLog()" novalidate="true">-->

      <div class="modal-body">
          <div class="row">
              <div class="col-xs-12 col-sm-12 col-md-12 ">
                  <label class="timereportlabel"> Story/Task </label>
                  <div class="customformfieldsmarginbottom">

                  <p-autoComplete  [(ngModel)]="text"  [minLength]="2"  placeholder="list of tasks" [suggestions]="search_results"  [style]="{'width':'100%'}"  (completeMethod)="searchTask($event)" id="addTimelogTask"></p-autoComplete>

                  </div>
              </div>
              
              <div class="col-xs-12 col-sm-12 col-md-12 relativediv">
                  <div class="addTaskErrors"></div>
              <!--<div *ngIf="submitted && task.errors " class="fielderror">
                <div  [hidden]="!task.errors.required">
                    Task is required
                </div>
                <div [hidden]="title.errors.required && (!title.errors.minlength || !title.errors.maxlength)">
                    Title must be 3 characters long
                </div>
            </div>-->
          </div>
          </div>
          <div class="row">
              <div class="col-xs-12 col-sm-12 col-md-12 ">
                  <label class="timereportlabel"> Description </label>

                  <textarea  name="description"     class="customformfieldstextarea customformfieldsmarginbottom" id="addTimelogDesc" ></textarea>

<!--                  <input type="text" class="customformfields " value=""  id="addTimelogDesc"/>-->
              <div id="descerr_msg" class="alert alert-danger" style="display:none;"></div>
              </div>
             <!-- <div class="col-xs-12 col-sm-12 col-md-12 relativediv">
              <div *ngIf="submitted && description.errors " class="fielderror">
                <div [hidden]="!description.errors.required">
                    Description is required
                </div>
                <div [hidden]="title.errors.required && (!title.errors.minlength || !title.errors.maxlength)">
                    Title must be 3 characters long
                </div>
            </div>
          </div>-->
          <div class="col-xs-12 col-sm-12 col-md-12 relativediv">
              <div class="addDescError"></div>
              </div>
          </div>
          <div class="row">
              <div class="col-xs-12 col-sm-4 col-md-4 ">
                  <label class="timereportlabel"> Hours </label>
                  <div class="relativediv">
                  <input type="text" class="customformfields "   id="addTimelogTime" (keyup)="inputKeyDown(1,'')"/>
                  <div class="addHoursError"></div>
                     <!--     <div *ngIf="submitted && hours.errors " class="fielderror">
                <div [hidden]="!hours.errors.required">
                    Hours is required
                </div>
                <div [hidden]="title.errors.required && (!title.errors.minlength || !title.errors.maxlength)">
                    Title must be 3 characters long
                </div>
            </div>-->
              </div>
              </div>
 
        
              <div class="col-xs-12 col-sm-8 col-md-8 ">
                  <label class="timereportlabel"> Date </label>
                  <div class="paddingright25 ">
                 <p-calendar   class="primeDateComponent customcalenderdiv"  [readonlyInput]="true" [maxDate]="calendarVal" [showIcon]="true"  dateFormat="M-dd-yy" id="addTimelogDate"  [(ngModel)]="dateVal">
                        </p-calendar>
                  </div>
              </div>
              <!-- <div class="col-xs-12 col-sm-8 col-md-8 relativediv">
              <div *ngIf="submitted && dateVal.errors " class="fielderror">
                <div [hidden]="!dateVal.errors.required">
                    Date is required
                </div>
                <div [hidden]="title.errors.required && (!title.errors.minlength || !title.errors.maxlength)">
                    Title must be 3 characters long
                </div>
            </div>
          </div>-->
          </div>
          
         </div>
    
      <div class="modal-footer">
        <button type="submit" class="normal bluebutton bluebuttonmedium " (click)="addTimeLog();">SUBMIT</button>
        <button type="button" class="normal bluebutton bluebuttonmedium tablebuttonsgrey " data-dismiss="modal">CANCEL</button>
      </div>
      <!-- </form>-->
    </div>
  </div>
</div>

