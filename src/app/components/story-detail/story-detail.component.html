<!--<input type="text" [(ngModel)]="vidUrl"/>

<video autoplay>
<source [src]="vidUrl" type="video/mp4">

</video>-->


<!--<vg-player>
    <video vgMedia id="singleVideo" preload="auto" controls>
        <source src="https://10.10.73.21/files/story/Matrix.mp4" type="video/mp4">
    </video>
</vg-player>-->


<div fileDrop (dragover)="fileOverBase($event)" (dragleave)=fileDragLeave($event) class="paddingbottom10">
    <!--Title Part-->
        <div class="titlearea  ">
          <div class="row">
              <div class="col-xs-12 col-sm-3 col-md-3 ticketidareanorightpadding">
                  <div class="ticketidarea">
                       <div class="pull-left paddingL10">
                  <button  class="normal bluebutton bluebuttonmedium" (click)="goToEditPage()">EDIT</button>
              </div>
                      <img *ngIf="ticketData?.data?.StoryType?.Id==1" src="assets/images/storyicon.png"  title="{{ticketData?.data?.StoryType?.Name}}"  />
                      <img  *ngIf="ticketData?.data?.StoryType?.Id==2" src="assets/images/task.png" title="{{ticketData?.data?.StoryType?.Name}}" /> 
                      #{{ticketData?.data?.TicketId}}
                  </div>
              </div>
            <div class="col-xs-12 col-sm-9 col-md-9">
              <div class="ticketdescriptionarea minheight50">
                <div class="viewinputtext " [innerHTML]="ticketData?.data?.Title" id="{{ticketData?.data?.TicketId}}_title" (dblclick)="editTitle()" [hidden]="!showTitleEdit">
                </div>
                <input class="editinput" type="text" [hidden]="showTitleEdit" (blur)="closeTitleEdit($event.target.value)" value="{{ticketData?.data?.Title}}" />
                <!--<div class="alert alert-danger" [innerHTML]="titleError" [hidden]="titleError == ''">
                </div>-->
              </div>
            </div>
          </div>
      </div>
      <!--Title Part End-->
  </div>

<div fileDrop (dragover)="fileOverBase($event)" (dragleave)=fileDragLeave($event) class="row">
      <div class="col-xs-12 col-sm-3 col-md-3 ticketidareanorightpaddingbottom" style="margin:0px;padding:0px;">
          <!--Left Pannel Starts-->
          <div class="leftpaneldiv">
              <!--<div class="leftpanelsections">
                  <button  class="normal bluebutton bluebuttonmedium" (click)="goToEditPage()">Edit</button>
              </div>-->
              <div>
                  <!--Left pannel fields
                  Loop renders the fields based on the renderType passed in fieldsData-->
                  <div *ngFor="let field of fieldsData;let i=index;">
                      <div class="leftpanelsections">
                           <label for="email" class="leftlabels">{{field.title}}</label>
                           <div class="leftreadonlyfontbluecolor" *ngIf="field.readonly" data-text="readonly" id="{{field.elIid}}">
                             {{field.value}}
                           </div>
                      
                    <div class="leftreadonlyfontgreycolor customcalender" [ngSwitch]="field.renderType" *ngIf="!field.readonly">
                        <div (click)="editThisField($event,i,field.elId,field.Id,field.title,field.renderType)" [hidden]="!showMyEditableField[i]" data-text="not readonly" 
                             id="{{field.elId}}" class="{{(field.title=='Status')? field.value:''}}">
                            {{(field.value == "") ? '--': field.value}} 
                            <i *ngIf="field.title == 'Priority'"  class="fa fa-circle {{field.value}}" aria-hidden="true">
                            </i>
                        </div>

                        <input *ngSwitchCase="'input'" class="editinput" (keyup.enter)="restoreField($event.target.value,field.elId,i,field.renderType,field.Id)" id='{{field.elId}}_{{i}}' type="{{field.type}}" value="{{field.value}}" [hidden]="showMyEditableField[i]"
                            (blur)="restoreField($event.target.value,field.elId,i,field.renderType,field.Id)" />

                        <p-calendar *ngSwitchCase="'date'" [(ngModel)]="dateVal" class="primeDateComponent" name="date_{{i}}" (onBlur)="dateBlur($event,i)" (onSelect)="restoreField($value,field.elId,i,field.renderType,field.Id)" id='{{field.elId}}_{{i}}' [readonlyInput]="true" [minDate]="minDate" [showIcon]="true" [hidden]="showMyEditableField[i]" dateFormat="mm-dd-yy">
                        </p-calendar>

                        <textarea *ngSwitchCase="'textarea'" class="custtextarea width100per" id='{{field.elId}}_{{i}}' name="{{field.fieldType}}" [ngModel]="field.value" [hidden]="showMyEditableField[i]" (blur)="restoreField($event.target.value,field.elId,i,field.renderType,field.Id)">
                        </textarea>

                        <div class="customdropdown">
                            <p-dropdown *ngSwitchCase="'select'" [style]="{'width':'100%'}" [ngModel]="field.valueId"   name="dropdownContainer_{{i}}" (onFocus)="dropdownFocus($event,i)" (onBlur)="selectBlurField($event,i)"  (onChange)="restoreField($event,field.elId,i,field.renderType,field.Id)" id='{{field.elId}}_{{i}}'  [hidden]="showMyEditableField[i]" [options]="dropList" >
                            </p-dropdown>
                            <input *ngSwitchCase="'select'" type="hidden" id="{{field.elId}}_{{i}}_currentSelected">
                        </div>
                    </div>
                  </div>
                </div>
                <!--Left Pannel Loop ends here-->
              </div>
          </div>
          <!--Left Pannel End-->
    </div>

    <div class="col-xs-12 col-sm-9 col-md-9">
      <div>
          <!--Description Part-->
        <div class="rightdescriptionarea" [hidden]="!showDescEditor">
             <div style="position: relative">
                  <div class="custwordwrap artifacts" [innerHTML]="ticketDesc" id="{{ticketData?.data?.TicketId}}_desc" (dblclick)="openDescEditor()" >
                  </div>  
             </div> 
        </div>
        <div [hidden]="showDescEditor">
            <div class="rightdescriptionarea">
                <div style="position: relative">
                     <div id="dropble" [ngClass]="{dragdrop: hasBaseDropZoneOver}" 
                          (drop)="fileUploadEvent($event, 'fileDrop','description')" >
                     </div>
                     <div [ngClass]="{pop_over_bg: fileUploadStatus}"><img *ngIf="fileUploadStatus" src="assets/images/loader.gif" height="20" width="70" alt=""/>
                     </div>
                     <ckeditor #detailEditor [config]="toolbarForDetail" [(ngModel)]="ticketEditableDesc" name="ticketEditableDesc" required >
                     </ckeditor>
                </div>
                <div class="alert alert-danger" [innerHTML]="descError" [hidden]="descError == ''">
                </div>
                <div class="uploadcomponent margintop15">
                      <div class="uploadbottom">
                        <i class="fa fa-paperclip" aria-hidden="true"></i>
                        File upload
                      </div>
                      <input class="transparentinput" type="file" (change)="fileUploadEvent($event, 'fileChange','description')"  multiple  />
                </div>
            </div>
            <div class="buttonarea alignright">
                  <button class="normal bluebutton bluebuttonmedium" (click)="submitDesc()">
                    SUBMIT
                  </button>
                  <button class="normal bluebutton greybutton bluebuttonmedium" (click)="cancelDesc()">
                    CANCEL
                  </button>
            </div>
          </div>
            <!--Description Part End-->
            <div class="expand_collapse">
            <a type="button" id="expand" (click)="expand()" class="expand"><span class="glyphicon glyphicon-chevron-up alignright"></span></a>
<a type="button" id="collapse" (click)="collapse()" class="collapse"><span class="glyphicon glyphicon-chevron-down alignright"></span></a>
</div>
<div class="main_div" [ngClass]="{ 'hide': hide}">
<div><label>Followers</label></div>
<div class="relate_story">
    <div class="custom_story_input">
        <div>Followers Area</div>
    </div>
   
   <div class="custom_story_button"><button class="normal bluebutton bluebuttonmedium">Add Followers</button></div>
 </div>

 <div><label>Attachments</label></div>
<div class="relate_story">
    <div class="custom_story_input">
        <div *ngFor="let attachment of attachmentsData;let i=index;">{{attachment}}</div>
    </div>
   
   <div class="custom_story_button"><button class="normal bluebutton bluebuttonmedium">Attachments</button></div>
 </div>

 <div><label>Tasks</label></div>
<div class="relate_story">
    <div class="custom_story_input">
       <div>Tasks Area</div>
    </div>
   
   <div class="custom_story_button"><button class="normal bluebutton bluebuttonmedium">Add Task</button></div>
 </div>



    <!--AutoSuggestion for Related Tickets-->
    <div><label>Relate Story/Tasks</label></div>
<div class="relate_story">
    <div class="custom_story_input">
        <p-autoComplete [(ngModel)]="text" [minLength]="2" placeholder="Related Tickets" [suggestions]="search_results"  [style]="{'width':'100%'}"  (completeMethod)="search($event)" ></p-autoComplete>
    </div>
   
   <div class="custom_story_button"><button class="normal bluebutton bluebuttonmedium">RELATE</button></div>
 </div>
 </div>

      </div>
<!--Comments Section-->
 <div class="widgethed">Activity</div>
 
 <div class="activitybg mt10">
<div>
    <!--Comment Display area-->
    
    <ng-container *ngFor="let comment of commentsList;let cmtIdx = index;">
        <div id="{{cmtIdx}}">
            
            
                    <div class="user">
              <a href="javascript:void(0)"> <img src="{{comment.ActivityBy.ProfilePicture}}" /></a>  by <span><a href="javascript:void(0)">{{comment.ActivityBy.UserName}}</a> </span> <div *ngIf="(comment.PropertyChanges.length == 0)" class="userdate">( {{comment.ActivityOn}} ) </div>    
            </div>
          <div *ngFor="let property of comment.PropertyChanges;">   
    <div class="ticketactivity">
   {{property.ActionFieldTitle}} {{property.Action}} <span *ngIf="property.type=='user'"> 
       <span class="property"><a href="javascript:void(0)" data-id="{{property.PreviousValue.CollaboratorId}}" data-name="{{property.PreviousValue.UserName}}">{{property.PreviousValue.UserName}}</a></span> <span *ngIf="property.PreviousValue!=''">to</span> <span class="property"><a href="#" data-id="{{property.NewValue.CollaboratorId}}" data-name="{{property.NewValue.UserName}}">{{property.NewValue.UserName}}</a> </span>
                </span>
    <span *ngIf="property.type!='user'"> 
        <span class="property"> {{property.PreviousValue}}</span> <span *ngIf="property.PreviousValue!=''">to</span> <span class="property">{{property.NewValue}}</span> 
                </span>
   
   <span class="erdate">( {{property.ActivityOn}} )</span>
</div>
                 </div>
            
            
            
            
        

            <div  *ngIf="(comment.PropertyChanges.length == 0)" id="commentContent" class="comment{{(comment.Status ==2)?'_reply':''}}" >
                <div class="commentedtext" *ngIf="comment.Status ==2" (click)="navigateToParentComment(comment.ParentIndex)" >
                    <div class="user">
                        <a href="javascript:void(0)">
                    <img src="{{commentsList[comment.ParentIndex].ActivityBy.ProfilePicture}}" />
                    </a>
                    by <span><a href="javascript:void(0)">{{commentsList[comment.ParentIndex].ActivityBy.UserName}}</a>
                    </span>
                    </div>
                    <div [innerHTML]="commentsList[comment.ParentIndex].CDescription">
                    </div>
                </div>
                <div class="commentp" [innerHTML]="comment.CDescription">
                
                </div>
                <div class="clearfix pull-right">
                <div class="commedit"><a href="javascript:void(0)"><img src="assets/images/comment-reply.png" (click)="replyComment(cmtIdx)"/></a></div> 
                <div class="commedit"><a href="javascript:void(0)"><img src="assets/images/comment-edit.png"/></a></div> 
                <div class="commedit"><a href="javascript:void(0)"><img src="assets/images/comment-delete.png"/></a></div>
                </div>
            </div>
          
        </div>
    </ng-container>
    <!--Comment Displa area end-->
</div>
        <div>
           
            <div id="commentEditorArea" >
                
                 <div class="commentedtext porel" [hidden]="!replying">
     <div class="commentclose"><a href="javascript:void()" (click)="cancelReply()"><img src="assets/images/comment-close.png"/></a></div>
                
                
                <div id="replyToSnippet"  >

                    <div id="replySnippetContent" *ngIf="replyToComment !=-1" >
                        <!--<span>{{commentsList[replyToComment].ActivityBy}}</span>-->
                        
                <div class="user">
              <a href="javascript:void(0)"> <img src="{{commentsList[replyToComment].ActivityBy.ProfilePicture}}" /></a>  by <span><a href="javascript:void(0)">{{commentsList[replyToComment].ActivityBy.UserName}}</a></span>    
            </div>   
               <div [innerHTML]="commentsList[replyToComment].CDescription">
                        </div>
                    </div>
                 
                </div>
                 </div>
                
                
                <div style="position: relative">
                     <div id="dropble" [ngClass]="{dragdrop: hasBaseDropZoneOver}" 
                          (drop)="fileUploadEvent($event, 'fileDrop','comments')" >
                     </div>
                     <div [ngClass]="{pop_over_bg: fileUploadStatus}"><img *ngIf="fileUploadStatus" src="assets/images/loader.gif" height="20" width="70" alt=""/>
                     </div>
                     <ckeditor #commentEditor [config]="toolbarForDetail" [(ngModel)]="commentDesc" name="commentDesc" required >
                     </ckeditor>
                </div>
                <div class="alert alert-danger" [innerHTML]="descError" [hidden]="descError == ''">
                </div>
                <div class="uploadcomponent margintop15">
                      <div class="uploadbottom">
                        <i class="fa fa-paperclip" aria-hidden="true"></i>
                        File upload
                      </div>
                      <input class="transparentinput" type="file" (change)="fileUploadEvent($event, 'fileChange','comments')"  multiple  />
                </div>
            </div>
            <div class="buttonarea alignright">
                  <button class="normal bluebutton bluebuttonmedium" (click)="submitComment()">
                    SUBMIT
                  </button>
                  
            </div>
          

        </div>
      </div>
<!--Comments Section End-->

    </div>
</div>